USE Malware_Project

SELECT * FROM Test T
 JOIN Test_Setting TS ON T.TestID = TS.TestID
 JOIN Setting S ON TS.SettingID = S.SettingID
 JOIN Setting_Type ST ON S.SettingTypeID = ST.SettingTypeID
 JOIN Test_Combination TC ON T.TestID = TC.TestID
ORDER BY T.Ratio DESC


SELECT * FROM msSettingCombinations

EXEC RunRatioTest2Combination
@SettingName1 = 'ExistsNotSet',
@SettingType1 = 'SmartScreen',
@SettingName2 = '63382',
@SettingType2 = 'AvStateID'

SELECT * FROM Setting_Type

DECLARE @RUN INT = 1
DECLARE @NUMROWS INT = (SELECT COUNT(*) FROM msSettingCombinations)
WHILE (@RUN < @NUMROWS) 
BEGIN
	DECLARE @STN1 varchar(100) = (SELECT SettingTypeName1 FROM msSettingCombinations WHERE RowID = @RUN)
	DECLARE @SN1 varchar(100) = (SELECT SettingName1 FROM msSettingCombinations WHERE RowID = @RUN)
	DECLARE @STN2 varchar(100) = (SELECT SettingTypeName2 FROM msSettingCombinations WHERE RowID = @RUN)
	DECLARE @SN2 varchar(100) = (SELECT SettingName2 FROM msSettingCombinations WHERE RowID = @RUN)

	EXEC RunRatioTest2Combination
	@SettingName1 = @SN1,
	@SettingType1 = @STN1,
	@SettingName2 = @SN2,
	@SettingType2 = @STN2
	SET @RUN = @RUN + 1
END

SELECT * FROM msProductCombinations

DECLARE @AvStateAvSig TABLE
(RowID INT not null,
ProductValue1 varchar(100) not null,
ProductValue2 varchar(100) not null)

INSERT INTO @AvStateAvSig(RowID,ProductValue1,ProductValue2)
SELECT RowID, ProductValue1, ProductValue2 FROM msProductCombinations WHERE ProductName1 = 'AvStateID' AND ProductName2 = 'AvSigVersion'

DECLARE @RUN2 INT = 1
DECLARE @NUMROWS2 INT = (SELECT COUNT(*) FROM @AvStateAvSig)
WHILE (@RUN2 < @NUMROWS2) 
BEGIN
	DECLARE @PV1 varchar(100) = (SELECT ProductValue1 FROM @AvStateAvSig WHERE RowID = @RUN2)
	DECLARE @PV2 varchar(100) = (SELECT ProductValue2 FROM @AvStateAvSig WHERE RowID = @RUN2)

	EXEC RunTestAvStateAvSig
	@AvStateID = @PV1,
	@AvSigVersion = @PV2
	SET @RUN2 = @RUN2 + 1
END

--2. WOW NONE EXIST--
DECLARE @AppAvSig TABLE
(RowID INT not null,
ProductValue1 varchar(100) not null,
ProductValue2 varchar(100) not null)

INSERT INTO @AppAvSig(RowID,ProductValue1,ProductValue2)
SELECT RowID, ProductValue1, ProductValue2 FROM msProductCombinations WHERE ProductName1 = 'AppVersion' AND ProductName2 = 'AvSigVersion'

DECLARE @RUN3 INT = 1
DECLARE @NUMROWS3 INT = (SELECT COUNT(*) FROM @AppAvSig)
WHILE (@RUN3 < @NUMROWS3) 
BEGIN
	DECLARE @PV12 varchar(100) = (SELECT ProductValue1 FROM @AppAvSig WHERE RowID = @RUN3)
	DECLARE @PV22 varchar(100) = (SELECT ProductValue2 FROM @AppAvSig WHERE RowID = @RUN3)

	EXEC RunTestAppAvSig
	@AppVersion = @PV12,
	@AvSigVersion = @PV22
	SET @RUN3 = @RUN3 + 1
END

--3.--
DECLARE @AvStateApp TABLE
(RowID INT not null,
ProductValue1 varchar(100) not null,
ProductValue2 varchar(100) not null)

INSERT INTO @AvStateApp(RowID,ProductValue1,ProductValue2)
SELECT RowID, ProductValue1, ProductValue2 FROM msProductCombinations WHERE ProductName1 = 'AvStateID' AND ProductName2 = 'AppVersion'

DECLARE @RUN4 INT = 1
DECLARE @NUMROWS4 INT = (SELECT COUNT(*) FROM @AvStateApp)
WHILE (@RUN4 < @NUMROWS4) 
BEGIN
	DECLARE @PV13 varchar(100) = (SELECT ProductValue1 FROM @AvStateApp WHERE RowID = @RUN4)
	DECLARE @PV23 varchar(100) = (SELECT ProductValue2 FROM @AvStateApp WHERE RowID = @RUN4)

	EXEC RunTestAvStateApp
	@AvStateID = @PV13,
	@AppVersion = @PV23
	SET @RUN4 = @RUN4 + 1
END

SELECT * FROM Test
SELECT * FROM Test_Combination