USE Malware_Project

CREATE TABLE Setting_Type (
    SettingTypeID INT IDENTITY PRIMARY KEY,
    SettingTypeName VARCHAR(100)
)

CREATE TABLE Setting (
    SettingID INT IDENTITY PRIMARY KEY ,
    SettingTypeID INT FOREIGN KEY REFERENCES Setting_Type(SettingTypeID),
    SettingName VARCHAR(100)
)
-- Block Insert
/*
INSERT INTO Setting_Type (SettingTypeName) VALUES ('IsBeta')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('RtpStateBitfield')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('IsSxsPassiveMode')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('AVProductsInstalled')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('AVProductsEnabled')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('HasTpm')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('LocaleEnglishNameIdentifier')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Platform')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('OsVer')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('OsBuild')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('OsSuite')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('OsPlatformSubRelease')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('OsBuildLab')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('SkuEdition')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('IsProtected')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('AutoSampleOptIn')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('PuaMode')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('SMode')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('IeVerIdentifier')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('SmartScreen')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Firewall')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('UacLuaenable')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_MDC2FormFactor')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OEMNameIdentifier')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OEMModelIdentifier')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_PrimaryDiskTotalCapacity')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_PrimaryDiskTypeName')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_SystemVolumeTotalCapacity')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_HasOpticalDiskDrive')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_PowerPlatformRoleName')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSVersion')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSArchitecture')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSBranch')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSBuildNumber')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSBuildRevision')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSEdition')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSSkuName')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSInstallTypeName')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSInstallLanguageIdentifier')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSUILocaleIdentifier')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_OSWUAutoUpdateOptionsName')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_IsPortableOperatingSystem')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_GenuineStateName')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_ActivationChannel')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_IsFlightingInternal')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_IsFlightsDisabled')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_FlightRing')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_ThresholdOptIn')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_IsSecureBootEnabled')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_IsWIMBootEnabled')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_IsVirtualDevice')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_IsTouchEnabled')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_IsPenCapable')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Census_IsAlwaysOnAlwaysConnectedCapable')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('Wdft_IsGamer')
INSERT INTO Setting_Type (SettingTypeName) VALUES ('HasDetections')
*/

/**
  Request:
    If you execute:
           SELECT * FROM Setting_Type
    You can see all the columns that are settings.
    For each column name, execute the following:
    SELECT '(Column name here )'

  **/
SELECT * FROM Setting_Type

/*
    Insert into Setting Logic:
    Select distinct [Column name from ]
*/

SELECT DISTINCT 'Wdft_IsGamer', Wdft_IsGamer FROM tblWorkingCopy

CREATE TABLE tempSetting (
    RowID INT IDENTITY PRIMARY KEY,
    SettingTypeName VARCHAR(100),
    SettingName VARCHAR(100)
)
CREATE TABLE runSetting (
    RowID INT IDENTITY PRIMARY KEY,
    SettingTypeName VARCHAR(100),
    SettingName VARCHAR(100)
)
TRUNCATE TABLE runSetting
SELECT COUNT(*) FROM runSetting
INSERT INTO runSetting (SettingTypeName, SettingName)
SELECT SettingTypeName, SettingName FROM tempSetting ORDER BY RowID DESC

CREATE -- ALTER
    PROC pGetSettingTypeID
@SettingTypeName NVARCHAR(100),
@SettingTypeID INT OUTPUT
AS
    BEGIN
        SET @SettingTypeID = (
            SELECT SettingTypeID FROM Setting_Type
            WHERE SettingTypeName = @SettingTypeName
            )
    end
GO

-- DECLARE @run INT = (SELECT COUNT(*) FROM tempSetting)
DECLARE @run INT = 1
DECLARE @max INT = (SELECT COUNT(*) FROM tempSetting)
WHILE @run <= @max
    BEGIN
        DECLARE @runSettingTypeName NVARCHAR(100) = (SELECT SettingTypeName FROM runSetting WHERE RowID = @run)
        DECLARE @runSettingName NVARCHAR(100) = (SELECT SettingName FROM runSetting WHERE RowID = @run)
        DECLARE @runSettingTypeID INT
        EXEC pGetSettingTypeID
            @SettingTypeName = @runSettingTypeName,
            @SettingTypeID = @runSettingTypeID OUTPUT
        INSERT INTO Setting (SettingTypeID, SettingName)
        VALUES (@runSettingTypeID, @runSettingName)
        DELETE FROM runSetting WHERE RowID = @run
        SET @run = @run + 1
end
GO

SELECT * FROM tempSetting ORDER BY RowID DESC
SELECT COUNT(*) FROM tempSetting

SELECT * FROM Setting WHERE SettingTypeID IS NULL OR SettingName IS NULL

SELECT * FROM Setting ORDER BY SettingID DESC
SELECT DISTINCT SettingTypeID FROM Setting


SELECT * FROM Setting_Type st
JOIN tempSetting tS on tS.SettingTypeName = st.SettingTypeName
JOIN Setting S on st.SettingTypeID = S.SettingTypeID
WHERE S.SettingName IS NULL
ORDER BY RowID ASC
SELECT * FROM Setting WHERE SettingName IS NULL


/* 
	Develop a loop to change the SettingName to that of the Setting in the tblWorkingCopy
	This should be a reversible process
*/

GO
CREATE -- ALTER
PROC yz273_pAlterSettingTrueFalse
    @STName VARCHAR(100)
AS
    BEGIN
        DECLARE @STID INT = (SELECT SettingTypeID FROM Setting_Type WHERE SettingTypeName = @STName)
        UPDATE Setting
        SET SettingName = '1' -- switch this and below for reversed process
        WHERE SettingTypeID = @STID
        AND SettingName = @STName -- switch this with the above variable
    end
GO

-- Wrapper table set up
CREATE TABLE TrueFalseSettingTable (
    RowID INT IDENTITY PRIMARY KEY ,
    SettingName VARCHAR(100)
                                     )
TRUNCATE TABLE TrueFalseSettingTable
INSERT INTO TrueFalseSettingTable (SettingName)
VALUES ('IsBeta'),
    ('IsSxsPassiveMode'),
    ('HasTpm'),
    ('IsProtected'),
    ('AutoSampleOptIn'),
    ('SMode'),
    ('IsVerIdentifier'),
    ('Firewall'),
    ('Census_HasOpticalDiskDrive'),
    ('Census_IsPortableOperatingSystem'),
    ('Census_IsFlightingInternal'),
    ('Census_IsFlightsDisabled'),
    ('Census_ThresholdOptIn'),
    ('Census_IsSecureBootEnabled'),
    ('Census_IsWIMBootEnabled'),
    ('Census_IsVirtualDevice'),
    ('Census_IsTouchEnabled'),
    ('Census_IsPenCapable'),
    ('Census_IsAlwaysOnAlwaysConnectedCapable'),
    ('Wdft_IsGamer'),
    ('HasDetections')
SELECT COUNT(*) FROM TrueFalseSettingTable

-- wrapper
DECLARE @index INT
DECLARE @max INT
SELECT @index = min(RowID) - 1, @max = MAX(RowID) FROM TrueFalseSettingTable
WHILE @index < @max
BEGIN
    DECLARE @newSTName VARCHAR(100) = (SELECT SettingName FROM TrueFalseSettingTable WHERE RowID = @index)
    EXEC yz273_pAlterSettingTrueFalse
    @STName = @newSTName
    DELETE FROM TrueFalseSettingTable WHERE RowID = @index
    SET @index = @index + 1
end

-- Verify results:
SELECT * FROM Setting s
JOIN Setting_Type ST on s.SettingTypeID = ST.SettingTypeID
WHERE ST.SettingTypeName IN (
    'IsBeta',
    'IsSxsPassiveMode',
    'HasTpm',
    'IsProtected',
    'AutoSampleOptIn',
    'SMode',
    'IsVerIdentifier',
    'Firewall',
    'Census_HasOpticalDiskDrive',
    'Census_IsPortableOperatingSystem',
    'Census_IsFlightingInternal',
    'Census_IsFlightsDisabled',
    'Census_ThresholdOptIn',
    'Census_IsSecureBootEnabled',
    'Census_IsWIMBootEnabled',
    'Census_IsVirtualDevice',
    'Census_IsTouchEnabled',
    'Census_IsPenCapable',
    'Census_IsAlwaysOnAlwaysConnectedCapable',
    'Wdft_IsGamer',
    'HasDetections'
    )